# geotiff_calssification

## How To Use (for hkryu@platnet.snu.ac.kr)
1. Activate Python Virtual Environment
    - ```source {ROOT}/geotiff_venv/bin/activate```
2. Training
    - Prepare Data
      - on Directory "```{ROOT}/data/training/```" make directories for each classes. (eg. open_water, sea_ice)
      - geotiff images are located in each class directory
    - Do Training
      - Move into models directory "```cd {ROOT}/models```"
      - Execute training.py "(eg.) ```./training.py --learningreate 0.01 --model simple_cnn --epoch 1000  --input ../data/```"
        - refer to training.sh file
        - options
          - input
            - specify training data directory. SHOULD INCLUD LAST "/" !!
          - learningrate
          - model
            - choose models. mlp, simple_cnn, resnet ... (not supported yet)
          - depth
            - only for resent! choose resnet depth (should be 6n + 2. eg 20, 32 ...)
          - channel
          - width
          - height
          - batch
          - epoch
          - weights
            - Saving model path. The trained model will be saved on this path + ".h5"
          - normalize
            - min, max values for each channel to normalize.
            - I should be a csv format file path! (eg, ./norm.txt)
            - csv format file includes two lines for mins and maxes, each line has value of mins (or maxes) with a comman sperated format.
              - refer {ROOT}/data/training/norm.txt file from planet.snu.ac.kr
     - Look into results
       - stdout shows the progress of training. Loss, Accuracy of training and validation
       - In directory, ```{ROOT}/models/saved_models/```, trained models are saved in .h5 format. (refer keras)
3. Testing
    - Prepare Data
    - Do Testing
      - Move into models directory "```cd {ROOT}/models```"
      - Execute predict.py "(eg.) ```./predict.py --wedights ./saved_models/simple_cnn_0.001.h5 --input /disk3/kopri/input.tif --output /disk1/hkryu/```"
        - refer to predict.sh file
        - options
          - input
            - specify input file to predict as a path. should be geotiff file.
          - weights
            - pre-trained file path, in .h5 format, generated by training.py. This file includes model spec, thus you don't need to inform network model to predict.py
          - channel
          - width
          - height
          - output
            - output directory path to save result tif files. predict.py copy the original input file to output path, and overwrite the results to copied tif file.
          - normalize
            - refer to normalize of training. Normalization data should be same as the data that was used in training.
    - Look into results
      - 1st channel of input Geotiff file is overwritten in results.
      - Raw output of NN is scaled to original size of Geotiff file using opencv.

## Roadmap
1.  preprocessing
    - read tiff file and split into small bitmap.
    - make it to class
2. look into data 
    - check mean, stdeviation, sin/cos theta
    - normailizing
3. model define
    - simple machine learning
    - small cnn / resnet
    - using keras!
3. testing

## Classes & Scripts

- GdalDirectoryReader
  - Read tif files from directory.
  - Crop tif files, and return ndarray (num of files, channel, width, height)

- GdalDataLoader

  - Preparing read data & write geotiff file using GdalDirectoryReader
  - Also, behave some operations such as normalize.
  - (recommend) Users should use this class instead of GdalDirectoryReader

- ModelLoader

  - Provides Network Models
  - For now, it makes mlp, simple cnn(lenet based model), and resnet.

- training.py

  - Training scripts. Using GdalDataLoader & ModelLoader.
  - Load training data, models and train it!

- predict.py

  - Predict scripts. Using GdalDataLoader
  - Load image, predict, write the results to file

- Other utilities

  - Normalize
  - Stats to retrieve data, or plot geotiff image.
    - plot images needs matplotlib / tk. not available in planet.snu.ac.kr now.

  
